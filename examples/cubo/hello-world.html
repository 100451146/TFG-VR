<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TensorSpace - Hello World</title>
    <meta name="author" content="syt123450 / https://github.com/syt123450">

    <script src="../../node_modules/three/build/three.min.js"></script> 
    <!-- <script src="../lib/three.min.js"></script>  -->
    <script src="../lib/tween.min.js"></script>
    <script src="../lib/tf.min.js"></script>
    <script src="../lib/TrackballControls.js"></script>
    <script src="../../dist/tensorspace.min.js"></script>

    <script src="../lib/jquery.min.js"></script>

    <style>

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }

        #container {
            width: 100%;
            height: 100%;
        }

    </style>

</head>
<body>

<div id="container"></div>

<script type="module">
    
    import * as THREE from "./dependencias/three.module.js";
    import { OrbitControls } from "./dependencias/OrbitControls.js";
    import { VRButton } from '../lib/VRButton.js';

    // create a scene
    let scene = new THREE.Scene();
    scene.background = new THREE.Color( 0x2a3b4c );
    
    // create a camera
    let camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight );
    camera.position.z = 5;
    
    // create a renderer
    let renderer = new THREE.WebGLRenderer();
    renderer.setSize( window.innerWidth, window.innerHeight );
    document.body.appendChild( renderer.domElement );

    // add geometry
    let geometry = new THREE.BoxGeometry();
    let material = new THREE.MeshBasicMaterial({color: 0x00ff00,});
    let cube = new THREE.Mesh(geometry, material);
    scene.add(cube);
    scene.add(new THREE.AmbientLight( 0x404040));

    // controles de la camara
    let controls = new OrbitControls( camera, renderer.domElement );
    controls.minDistance = 3;
    controls.maxDistance = 10;
    controls.enableDamping = true;
    controls.dampingFactor = 0.5;
    controls.maxPolarAngle = Math.PI;
    controls.screenSpacePanning = true;
    controls.target.set( 0, 0, 0 );

    document.body.appendChild( VRButton.createButton( renderer ) );
    renderer.xr.enabled = true;

    function animate() {
        renderer.render( scene, camera );
        requestAnimationFrame( animate );
    }

    let modelContainer = document.getElementById( "container" );
    let model = new TSP.models.Sequential( modelContainer );

    model.add( new TSP.layers.GreyscaleInput() );
    model.add( new TSP.layers.Padding2d() );
    model.add( new TSP.layers.Conv2d() );
    model.add( new TSP.layers.Pooling2d() );
    model.add( new TSP.layers.Conv2d() );
    model.add( new TSP.layers.Pooling2d() );
    model.add( new TSP.layers.Dense() );
    model.add( new TSP.layers.Dense() );
    model.add( new TSP.layers.Output1d({
        outputs: ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"]
    }) );

    model.load({
        type: "tensorflow",
        url: './convertedModel/model.json'
    });
    model.init( function() {

        $.ajax({
            url: "./data/5.json",
            type: 'GET',
            async: true,
            dataType: 'json',
            success: function (data) {
                model.predict( data );
            },
            error: function (xhr, status, error) {
                console.log(xhr);
                console.log(status);
                console.log(error);
            }
        });

    // Añadir el modelo a la escena
    scene.add(model);

    // Animación en bucle
    renderer.setAnimationLoop(() => {
        renderer.render(scene, camera);
        controls.update();
    });

    animate();
}); 
    
</script>

</body>
</html>
